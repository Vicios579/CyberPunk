<!DOCTYPE html>
<html lang="pt-BR">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   <link rel="stylesheet" href="./css/global.css" />
   <link rel="stylesheet" href="./css/style.css" />
   <link rel="stylesheet" href="./css/login.css" />
   <title>Login</title>
</head>
<body> 
   <div class="header">
      <a href="./index.html"><img src="./Assets/logos/logo_preta.svg" alt="Logo Cyberpunk" class="logo" /></a>

      <button>
         <span></span>
         <a href="./index.html">VOLTAR</a>
      </button>
   </div>

   <div class="login-card">
      <div class="login-card-title">
         <h1 class="text-highlight-red">LOGIN</h1>
         <p>Acesse seu sistema de implantes</p>
      </div>

      <form onsubmit="submitado(event)">
         <div>
            <label for="email">E-MAIL</label>
            <input type="text" name="email" id="email">
         </div>
         <div>
            <label for="senha">SENHA</label>
            <input type="text" name="senha" id="senha">
            <i class="fa-solid fa-eye"></i>
         </div>
 
         <button type="submit" onclick="entrar()">ENTRAR</button>
      </form>

      <p>Primeiro acesso? <a href="./cadastro.html">Registre-se aqui</a></p>
   </div>

   <div class="footer">
         <img src="./Assets/logos/logo_vermelha.svg" alt="">
         <div>
            <p>IDEALIZADO E DESENVOLVIDO POR VINICIUS C.G</p>
            <p>SPTECH - 2025</p>
         </div>
      </div>

</body>
</html>

<script>
   function submitado(event) {
      event.preventDefault()
   }

   function entrar() {
      var emailVar = email.value;
      var senhaVar = senha.value;

      if (emailVar == "" || senhaVar == "") {
         alert('Verifique os campos vazios.')
         return false;
      }

      console.log("FORM LOGIN: ", emailVar);
      console.log("FORM SENHA: ", senhaVar);

      fetch("/usuarios/autenticar", {
         method: "POST",
         headers: {"Content-Type": "application/json"},
         body: JSON.stringify({
            emailServer: emailVar,
            senhaServer: senhaVar
         })
      }).then(function(resposta) {
         console.log("ESTOU NO THEN DO entrar()!") 

         if (resposta.ok) {
            console.log(resposta)

            resposta.json().then(function(json) {
               console.log(json);
               console.log(JSON.stringify(json));

               sessionStorage.EMAIL_USUARIO = json[0].email;
               sessionStorage.NOME_USUARIO = json[0].nome;

               // apenas para exibir o loading
               setTimeout(function () {
                  window.location.href = "dashboard.html";
               }, 1000);
            })
         } else {
            alert('Login Inv√°lido, tente novamente.')
            console.log("Houve um erro ao tentar realizar o login!");
         }
      }).catch(function (erro) {
         console.log(erro);
      })

      return false
   }
</script>